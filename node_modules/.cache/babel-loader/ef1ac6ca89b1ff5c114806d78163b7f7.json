{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar _classCallCheck = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _inherits = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/inherits\");\n\nvar _createSuper = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createSuper\");\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SafeAppConnector = void 0;\n\nvar abstract_connector_1 = require(\"@web3-react/abstract-connector\");\n\nvar safe_apps_sdk_1 = __importDefault(require(\"@gnosis.pm/safe-apps-sdk\"));\n\nvar safe_apps_provider_1 = require(\"@gnosis.pm/safe-apps-provider\");\n\nvar SafeAppConnector = /*#__PURE__*/function (_abstract_connector_) {\n  _inherits(SafeAppConnector, _abstract_connector_);\n\n  var _super = _createSuper(SafeAppConnector);\n\n  function SafeAppConnector() {\n    var _this;\n\n    _classCallCheck(this, SafeAppConnector);\n\n    _this = _super.apply(this, arguments);\n    _this.sdk = new safe_apps_sdk_1.default();\n    return _this;\n  }\n\n  _createClass(SafeAppConnector, [{\n    key: \"activate\",\n    value: function () {\n      var _activate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var runningAsSafeApp;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.isSafeApp();\n\n              case 2:\n                runningAsSafeApp = _context.sent;\n\n                if (runningAsSafeApp) {\n                  _context.next = 5;\n                  break;\n                }\n\n                throw new Error('The app is loaded outside safe context');\n\n              case 5:\n                _context.next = 7;\n                return this.getProvider();\n\n              case 7:\n                _context.t0 = _context.sent;\n                _context.next = 10;\n                return this.getChainId();\n\n              case 10:\n                _context.t1 = _context.sent;\n                _context.next = 13;\n                return this.getAccount();\n\n              case 13:\n                _context.t2 = _context.sent;\n                return _context.abrupt(\"return\", {\n                  provider: _context.t0,\n                  chainId: _context.t1,\n                  account: _context.t2\n                });\n\n              case 15:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function activate() {\n        return _activate.apply(this, arguments);\n      }\n\n      return activate;\n    }()\n  }, {\n    key: \"getSafeInfo\",\n    value: function () {\n      var _getSafeInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (this.safe) {\n                  _context2.next = 4;\n                  break;\n                }\n\n                _context2.next = 3;\n                return this.sdk.safe.getInfo();\n\n              case 3:\n                this.safe = _context2.sent;\n\n              case 4:\n                return _context2.abrupt(\"return\", this.safe);\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function getSafeInfo() {\n        return _getSafeInfo.apply(this, arguments);\n      }\n\n      return getSafeInfo;\n    }()\n  }, {\n    key: \"getProvider\",\n    value: function () {\n      var _getProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var safe;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                if (this.provider) {\n                  _context3.next = 5;\n                  break;\n                }\n\n                _context3.next = 3;\n                return this.getSafeInfo();\n\n              case 3:\n                safe = _context3.sent;\n                this.provider = new safe_apps_provider_1.SafeAppProvider(safe, this.sdk);\n\n              case 5:\n                return _context3.abrupt(\"return\", this.provider);\n\n              case 6:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function getProvider() {\n        return _getProvider.apply(this, arguments);\n      }\n\n      return getProvider;\n    }()\n  }, {\n    key: \"getChainId\",\n    value: function () {\n      var _getChainId = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        var provider;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.getProvider();\n\n              case 2:\n                provider = _context4.sent;\n                return _context4.abrupt(\"return\", provider.chainId);\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function getChainId() {\n        return _getChainId.apply(this, arguments);\n      }\n\n      return getChainId;\n    }()\n  }, {\n    key: \"getAccount\",\n    value: function () {\n      var _getAccount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5() {\n        var safe;\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.getSafeInfo();\n\n              case 2:\n                safe = _context5.sent;\n                return _context5.abrupt(\"return\", safe.safeAddress);\n\n              case 4:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function getAccount() {\n        return _getAccount.apply(this, arguments);\n      }\n\n      return getAccount;\n    }()\n  }, {\n    key: \"deactivate\",\n    value: function deactivate() {\n      return;\n    }\n  }, {\n    key: \"isSafeApp\",\n    value: function () {\n      var _isSafeApp = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6() {\n        var safe;\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return Promise.race([this.getSafeInfo(), new Promise(function (resolve) {\n                  return setTimeout(resolve, 300);\n                })]);\n\n              case 2:\n                safe = _context6.sent;\n                return _context6.abrupt(\"return\", !!safe);\n\n              case 4:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function isSafeApp() {\n        return _isSafeApp.apply(this, arguments);\n      }\n\n      return isSafeApp;\n    }()\n  }]);\n\n  return SafeAppConnector;\n}(abstract_connector_1.AbstractConnector);\n\nexports.SafeAppConnector = SafeAppConnector;","map":{"version":3,"sources":["../src/connector.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,oBAAA,GAAA,OAAA,CAAA,gCAAA,CAAA;;AAEA,IAAA,eAAA,GAAA,eAAA,CAAA,OAAA,CAAA,0BAAA,CAAA,CAAA;;AACA,IAAA,oBAAA,GAAA,OAAA,CAAA,+BAAA,CAAA;;IAEM,gB;;;;;AAAN,8BAAA;AAAA;;AAAA;;;AACmB,UAAA,GAAA,GAAM,IAAI,eAAA,CAAA,OAAJ,EAAN;AADnB;AAmDC;;;;;+EA9CC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACiC,KAAK,SAAL,EADjC;;AAAA;AACQ,gBAAA,gBADR;;AAAA,oBAEO,gBAFP;AAAA;AAAA;AAAA;;AAAA,sBAGU,IAAI,KAAJ,CAAU,wCAAV,CAHV;;AAAA;AAAA;AAAA,uBAM2B,KAAK,WAAL,EAN3B;;AAAA;AAAA;AAAA;AAAA,uBAM8D,KAAK,UAAL,EAN9D;;AAAA;AAAA;AAAA;AAAA,uBAMgG,KAAK,UAAL,EANhG;;AAAA;AAAA;AAAA;AAMW,kBAAA,QANX;AAM+C,kBAAA,OAN/C;AAMiF,kBAAA,OANjF;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;kFASO;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,KAAK,IADL;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAEe,KAAK,GAAL,CAAS,IAAT,CAAc,OAAd,EAFf;;AAAA;AAEH,qBAAK,IAFF;;AAAA;AAAA,kDAIE,KAAK,IAJP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;kFAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,oBACA,KAAK,QADL;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAEgB,KAAK,WAAL,EAFhB;;AAAA;AAEG,gBAAA,IAFH;AAGH,qBAAK,QAAL,GAAgB,IAAI,oBAAA,CAAA,eAAJ,CAAoB,IAApB,EAA0B,KAAK,GAA/B,CAAhB;;AAHG;AAAA,kDAKE,KAAK,QALP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;iFAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACkB,KAAK,WAAL,EADlB;;AAAA;AACC,gBAAA,QADD;AAAA,kDAEE,QAAQ,CAAC,OAFX;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;iFAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACc,KAAK,WAAL,EADd;;AAAA;AACC,gBAAA,IADD;AAAA,kDAEE,IAAI,CAAC,WAFP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;WAKA,sBAAU;AACf;AACD;;;;gFAEM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,uBACc,OAAO,CAAC,IAAR,CAAa,CAC9B,KAAK,WAAL,EAD8B,EAE9B,IAAI,OAAJ,CAAuB,UAAC,OAAD;AAAA,yBAAa,UAAU,CAAC,OAAD,EAAU,GAAV,CAAvB;AAAA,iBAAvB,CAF8B,CAAb,CADd;;AAAA;AACC,gBAAA,IADD;AAAA,kDAME,CAAC,CAAC,IANJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;EA3CsB,oBAAA,CAAA,iB;;AAqDtB,OAAA,CAAA,gBAAA,GAAA,gBAAA","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SafeAppConnector = void 0;\nconst abstract_connector_1 = require(\"@web3-react/abstract-connector\");\nconst safe_apps_sdk_1 = __importDefault(require(\"@gnosis.pm/safe-apps-sdk\"));\nconst safe_apps_provider_1 = require(\"@gnosis.pm/safe-apps-provider\");\nclass SafeAppConnector extends abstract_connector_1.AbstractConnector {\n    constructor() {\n        super(...arguments);\n        this.sdk = new safe_apps_sdk_1.default();\n    }\n    async activate() {\n        const runningAsSafeApp = await this.isSafeApp();\n        if (!runningAsSafeApp) {\n            throw new Error('The app is loaded outside safe context');\n        }\n        return { provider: await this.getProvider(), chainId: await this.getChainId(), account: await this.getAccount() };\n    }\n    async getSafeInfo() {\n        if (!this.safe) {\n            this.safe = await this.sdk.safe.getInfo();\n        }\n        return this.safe;\n    }\n    async getProvider() {\n        if (!this.provider) {\n            const safe = await this.getSafeInfo();\n            this.provider = new safe_apps_provider_1.SafeAppProvider(safe, this.sdk);\n        }\n        return this.provider;\n    }\n    async getChainId() {\n        const provider = await this.getProvider();\n        return provider.chainId;\n    }\n    async getAccount() {\n        const safe = await this.getSafeInfo();\n        return safe.safeAddress;\n    }\n    deactivate() {\n        return;\n    }\n    async isSafeApp() {\n        const safe = await Promise.race([\n            this.getSafeInfo(),\n            new Promise((resolve) => setTimeout(resolve, 300)),\n        ]);\n        return !!safe;\n    }\n}\nexports.SafeAppConnector = SafeAppConnector;\n//# sourceMappingURL=connector.js.map"]},"metadata":{},"sourceType":"script"}