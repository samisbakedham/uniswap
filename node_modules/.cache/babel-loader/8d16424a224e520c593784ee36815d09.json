{"ast":null,"code":"\"use strict\";\n\nvar _classCallCheck = require(\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __exportStar = this && this.__exportStar || function (m, exports) {\n  for (var p in m) {\n    if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n  }\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar messageFormatter_1 = require(\"./messageFormatter\");\n\nvar PostMessageCommunicator = function PostMessageCommunicator() {\n  var _this = this;\n\n  var allowedOrigins = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n  var debugMode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n  _classCallCheck(this, PostMessageCommunicator);\n\n  this.allowedOrigins = null;\n  this.callbacks = new Map();\n  this.debugMode = false;\n\n  this.isValidMessage = function (_ref) {\n    var origin = _ref.origin,\n        data = _ref.data,\n        source = _ref.source;\n    var emptyOrMalformed = !data;\n    var sentFromParentEl = source === window.parent;\n    var majorVersionNumber = typeof data.version !== 'undefined' && parseInt(data.version.split('.')[0]);\n    var allowedSDKVersion = majorVersionNumber >= 1;\n    var validOrigin = true;\n\n    if (Array.isArray(_this.allowedOrigins)) {\n      validOrigin = _this.allowedOrigins.find(function (regExp) {\n        return regExp.test(origin);\n      }) !== undefined;\n    }\n\n    return !emptyOrMalformed && sentFromParentEl && allowedSDKVersion && validOrigin;\n  };\n\n  this.logIncomingMessage = function (msg) {\n    console.info(\"Safe Apps SDK v1: A message was received from origin \".concat(msg.origin, \". \"), msg.data);\n  };\n\n  this.onParentMessage = function (msg) {\n    if (_this.isValidMessage(msg)) {\n      _this.debugMode && _this.logIncomingMessage(msg);\n\n      _this.handleIncomingMessage(msg.data);\n    }\n  };\n\n  this.handleIncomingMessage = function (payload) {\n    var id = payload.id;\n\n    var cb = _this.callbacks.get(id);\n\n    if (cb) {\n      cb(payload);\n\n      _this.callbacks.delete(id);\n    }\n  };\n\n  this.send = function (method, params) {\n    var request = messageFormatter_1.MessageFormatter.makeRequest(method, params);\n\n    if (typeof window === 'undefined') {\n      throw new Error(\"Window doesn't exist\");\n    }\n\n    window.parent.postMessage(request, '*');\n    return new Promise(function (resolve, reject) {\n      _this.callbacks.set(request.id, function (response) {\n        if (!response.success) {\n          reject(new Error(response.error));\n          return;\n        }\n\n        resolve(response);\n      });\n    });\n  };\n\n  this.allowedOrigins = allowedOrigins;\n  this.debugMode = debugMode;\n  window.addEventListener('message', this.onParentMessage);\n};\n\nexports.default = PostMessageCommunicator;\n\n__exportStar(require(\"./methods\"), exports);","map":{"version":3,"sources":["../../../src/communication/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst messageFormatter_1 = require(\"./messageFormatter\");\nclass PostMessageCommunicator {\n    constructor(allowedOrigins = null, debugMode = false) {\n        this.allowedOrigins = null;\n        this.callbacks = new Map();\n        this.debugMode = false;\n        this.isValidMessage = ({ origin, data, source }) => {\n            const emptyOrMalformed = !data;\n            const sentFromParentEl = source === window.parent;\n            const majorVersionNumber = typeof data.version !== 'undefined' && parseInt(data.version.split('.')[0]);\n            const allowedSDKVersion = majorVersionNumber >= 1;\n            let validOrigin = true;\n            if (Array.isArray(this.allowedOrigins)) {\n                validOrigin = this.allowedOrigins.find((regExp) => regExp.test(origin)) !== undefined;\n            }\n            return !emptyOrMalformed && sentFromParentEl && allowedSDKVersion && validOrigin;\n        };\n        this.logIncomingMessage = (msg) => {\n            console.info(`Safe Apps SDK v1: A message was received from origin ${msg.origin}. `, msg.data);\n        };\n        this.onParentMessage = (msg) => {\n            if (this.isValidMessage(msg)) {\n                this.debugMode && this.logIncomingMessage(msg);\n                this.handleIncomingMessage(msg.data);\n            }\n        };\n        this.handleIncomingMessage = (payload) => {\n            const { id } = payload;\n            const cb = this.callbacks.get(id);\n            if (cb) {\n                cb(payload);\n                this.callbacks.delete(id);\n            }\n        };\n        this.send = (method, params) => {\n            const request = messageFormatter_1.MessageFormatter.makeRequest(method, params);\n            if (typeof window === 'undefined') {\n                throw new Error(\"Window doesn't exist\");\n            }\n            window.parent.postMessage(request, '*');\n            return new Promise((resolve, reject) => {\n                this.callbacks.set(request.id, (response) => {\n                    if (!response.success) {\n                        reject(new Error(response.error));\n                        return;\n                    }\n                    resolve(response);\n                });\n            });\n        };\n        this.allowedOrigins = allowedOrigins;\n        this.debugMode = debugMode;\n        window.addEventListener('message', this.onParentMessage);\n    }\n}\nexports.default = PostMessageCommunicator;\n__exportStar(require(\"./methods\"), exports);\n//# sourceMappingURL=index.js.map"]},"metadata":{},"sourceType":"script"}