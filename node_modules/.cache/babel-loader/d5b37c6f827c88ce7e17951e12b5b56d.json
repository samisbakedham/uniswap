{"ast":null,"code":"import _regeneratorRuntime from\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/safahi/Downloads/interface-4.30.1/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _styled from\"styled-components\";import{Trans}from\"@lingui/react\";import{defaultAbiCoder}from'@ethersproject/abi';import{getAddress,isAddress}from'@ethersproject/address';import{ButtonError}from'components/Button';import{BlueCard}from'components/Card';import{AutoColumn}from'components/Column';import{useActiveWeb3React}from'hooks/web3';import JSBI from'jsbi';import{Wrapper}from'pages/Pool/styleds';import React,{useCallback,useMemo,useState}from'react';import{ProposalState,useCreateProposalCallback,useLatestProposalId,useProposalData,useProposalThreshold,useUserVotes}from'state/governance/hooks';import{tryParseAmount}from'state/swap/hooks';import{ExternalLink,ThemedText}from'theme';import{CreateProposalTabs}from'../../components/NavigationTabs';import{UNI}from'../../constants/tokens';import AppBody from'../AppBody';import{ProposalActionDetail}from'./ProposalActionDetail';import{ProposalAction,ProposalActionSelector,ProposalActionSelectorModal}from'./ProposalActionSelector';import{ProposalEditor}from'./ProposalEditor';import{ProposalSubmissionModal}from'./ProposalSubmissionModal';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreateProposalButton=function CreateProposalButton(_ref){var proposalThreshold=_ref.proposalThreshold,hasActiveOrPendingProposal=_ref.hasActiveOrPendingProposal,hasEnoughVote=_ref.hasEnoughVote,isFormInvalid=_ref.isFormInvalid,handleCreateProposal=_ref.handleCreateProposal;var formattedProposalThreshold=proposalThreshold?JSBI.divide(proposalThreshold.quotient,JSBI.exponentiate(JSBI.BigInt(10),JSBI.BigInt(proposalThreshold.currency.decimals))).toLocaleString():undefined;return/*#__PURE__*/_jsx(ButtonError,{style:{marginTop:'18px'},error:hasActiveOrPendingProposal||!hasEnoughVote,disabled:isFormInvalid||hasActiveOrPendingProposal||!hasEnoughVote,onClick:handleCreateProposal,children:hasActiveOrPendingProposal?/*#__PURE__*/_jsx(Trans,{id:\"You already have an active or pending proposal\"}):!hasEnoughVote?/*#__PURE__*/_jsx(_Fragment,{children:formattedProposalThreshold?/*#__PURE__*/_jsx(Trans,{id:\"You must have {formattedProposalThreshold} votes to submit a proposal\",values:{formattedProposalThreshold:formattedProposalThreshold}}):/*#__PURE__*/_jsx(Trans,{id:\"You don't have enough votes to submit a proposal\"})}):/*#__PURE__*/_jsx(Trans,{id:\"Create Proposal\"})});};var CreateProposalWrapper=_styled(Wrapper).withConfig({componentId:\"sc-38qcfg-0\"})([\"display:flex;flex-flow:column wrap;\"]);var AutonomousProposalCTA=_styled.div.withConfig({componentId:\"sc-38qcfg-1\"})([\"text-align:center;margin-top:10px;\"]);export default function CreateProposal(){var _useLatestProposalId;var _useActiveWeb3React=useActiveWeb3React(),account=_useActiveWeb3React.account,chainId=_useActiveWeb3React.chainId;var latestProposalId=(_useLatestProposalId=useLatestProposalId(account!==null&&account!==void 0?account:undefined))!==null&&_useLatestProposalId!==void 0?_useLatestProposalId:'0';// the first argument below should be the index of the latest governor\nvar latestProposalData=useProposalData(/* governorIndex */2,latestProposalId);var _useUserVotes=useUserVotes(),availableVotes=_useUserVotes.votes;var proposalThreshold=useProposalThreshold();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),modalOpen=_useState2[0],setModalOpen=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),hash=_useState4[0],setHash=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),attempting=_useState6[0],setAttempting=_useState6[1];var _useState7=useState(ProposalAction.TRANSFER_TOKEN),_useState8=_slicedToArray(_useState7,2),proposalAction=_useState8[0],setProposalAction=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),toAddressValue=_useState10[0],setToAddressValue=_useState10[1];var _useState11=useState(UNI[chainId!==null&&chainId!==void 0?chainId:1]),_useState12=_slicedToArray(_useState11,2),currencyValue=_useState12[0],setCurrencyValue=_useState12[1];var _useState13=useState(''),_useState14=_slicedToArray(_useState13,2),amountValue=_useState14[0],setAmountValue=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),titleValue=_useState16[0],setTitleValue=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),bodyValue=_useState18[0],setBodyValue=_useState18[1];var handleActionSelectorClick=useCallback(function(){setModalOpen(true);},[setModalOpen]);var handleActionChange=useCallback(function(proposalAction){setProposalAction(proposalAction);},[setProposalAction]);var handleDismissActionSelector=useCallback(function(){setModalOpen(false);},[setModalOpen]);var handleDismissSubmissionModal=useCallback(function(){setHash(undefined);setAttempting(false);},[setHash,setAttempting]);var handleToAddressInput=useCallback(function(toAddress){setToAddressValue(toAddress);},[setToAddressValue]);var handleCurrencySelect=useCallback(function(currency){setCurrencyValue(currency);},[setCurrencyValue]);var handleAmountInput=useCallback(function(amount){setAmountValue(amount);},[setAmountValue]);var handleTitleInput=useCallback(function(title){setTitleValue(title);},[setTitleValue]);var handleBodyInput=useCallback(function(body){setBodyValue(body);},[setBodyValue]);var isFormInvalid=useMemo(function(){return Boolean(!proposalAction||!isAddress(toAddressValue)||!(currencyValue===null||currencyValue===void 0?void 0:currencyValue.isToken)||amountValue===''||titleValue===''||bodyValue==='');},[proposalAction,toAddressValue,currencyValue,amountValue,titleValue,bodyValue]);var hasEnoughVote=Boolean(availableVotes&&proposalThreshold&&JSBI.greaterThanOrEqual(availableVotes.quotient,proposalThreshold.quotient));var createProposalCallback=useCreateProposalCallback();var handleCreateProposal=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _createProposalCallba;var createProposalData,tokenAmount,types,values,i,hash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setAttempting(true);createProposalData={};if(!(!createProposalCallback||!proposalAction||!currencyValue.isToken)){_context.next=4;break;}return _context.abrupt(\"return\");case 4:tokenAmount=tryParseAmount(amountValue,currencyValue);if(tokenAmount){_context.next=7;break;}return _context.abrupt(\"return\");case 7:createProposalData.targets=[currencyValue.address];createProposalData.values=['0'];createProposalData.description=\"# \".concat(titleValue,\"\\n\\n\").concat(bodyValue,\"\\n\");_context.t0=proposalAction;_context.next=_context.t0===ProposalAction.TRANSFER_TOKEN?13:_context.t0===ProposalAction.APPROVE_TOKEN?17:21;break;case 13:types=[['address','uint256']];values=[[getAddress(toAddressValue),tokenAmount.quotient.toString()]];createProposalData.signatures=[\"transfer(\".concat(types[0].join(','),\")\")];return _context.abrupt(\"break\",21);case 17:types=[['address','uint256']];values=[[getAddress(toAddressValue),tokenAmount.quotient.toString()]];createProposalData.signatures=[\"approve(\".concat(types[0].join(','),\")\")];return _context.abrupt(\"break\",21);case 21:createProposalData.calldatas=[];for(i=0;i<createProposalData.signatures.length;i++){createProposalData.calldatas[i]=defaultAbiCoder.encode(types[i],values[i]);}_context.next=25;return(_createProposalCallba=createProposalCallback(createProposalData!==null&&createProposalData!==void 0?createProposalData:undefined))===null||_createProposalCallba===void 0?void 0:_createProposalCallba.catch(function(){setAttempting(false);});case 25:hash=_context.sent;if(hash)setHash(hash);case 27:case\"end\":return _context.stop();}}},_callee);}));return function handleCreateProposal(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(AppBody,{maxWidth:'800px',children:[/*#__PURE__*/_jsx(CreateProposalTabs,{}),/*#__PURE__*/_jsxs(CreateProposalWrapper,{children:[/*#__PURE__*/_jsx(BlueCard,{children:/*#__PURE__*/_jsx(AutoColumn,{gap:\"10px\",children:/*#__PURE__*/_jsx(ThemedText.Link,{fontWeight:400,color:'primaryText1',children:/*#__PURE__*/_jsx(Trans,{id:\"<0>Tip:</0> Select an action and describe your proposal for the community. The proposal cannot be modified after submission, so please verify all information before submitting. The voting period will begin immediately and last for 7 days. To propose a custom action, <1>read the docs</1>.\",components:{0:/*#__PURE__*/_jsx(\"strong\",{}),1:/*#__PURE__*/_jsx(ExternalLink,{href:\"https://uniswap.org/docs/v2/governance/governance-reference/#propose\"})}})})})}),/*#__PURE__*/_jsx(ProposalActionSelector,{onClick:handleActionSelectorClick,proposalAction:proposalAction}),/*#__PURE__*/_jsx(ProposalActionDetail,{proposalAction:proposalAction,currency:currencyValue,amount:amountValue,toAddress:toAddressValue,onCurrencySelect:handleCurrencySelect,onAmountInput:handleAmountInput,onToAddressInput:handleToAddressInput}),/*#__PURE__*/_jsx(ProposalEditor,{title:titleValue,body:bodyValue,onTitleInput:handleTitleInput,onBodyInput:handleBodyInput}),/*#__PURE__*/_jsx(CreateProposalButton,{proposalThreshold:proposalThreshold,hasActiveOrPendingProposal:(latestProposalData===null||latestProposalData===void 0?void 0:latestProposalData.status)===ProposalState.ACTIVE||(latestProposalData===null||latestProposalData===void 0?void 0:latestProposalData.status)===ProposalState.PENDING,hasEnoughVote:hasEnoughVote,isFormInvalid:isFormInvalid,handleCreateProposal:handleCreateProposal}),!hasEnoughVote?/*#__PURE__*/_jsxs(AutonomousProposalCTA,{children:[\"Don\\u2019t have 2.5M votes? Anyone can create an autonomous proposal using\",' ',/*#__PURE__*/_jsx(ExternalLink,{href:\"https://fish.vote\",children:\"fish.vote\"})]}):null]}),/*#__PURE__*/_jsx(ProposalActionSelectorModal,{isOpen:modalOpen,onDismiss:handleDismissActionSelector,onProposalActionSelect:function onProposalActionSelect(proposalAction){return handleActionChange(proposalAction);}}),/*#__PURE__*/_jsx(ProposalSubmissionModal,{isOpen:attempting,hash:hash,onDismiss:handleDismissSubmissionModal})]});}","map":{"version":3,"sources":["/Users/safahi/Downloads/interface-4.30.1/src/pages/CreateProposal/index.tsx"],"names":["defaultAbiCoder","getAddress","isAddress","ButtonError","BlueCard","AutoColumn","useActiveWeb3React","JSBI","Wrapper","React","useCallback","useMemo","useState","ProposalState","useCreateProposalCallback","useLatestProposalId","useProposalData","useProposalThreshold","useUserVotes","tryParseAmount","ExternalLink","ThemedText","CreateProposalTabs","UNI","AppBody","ProposalActionDetail","ProposalAction","ProposalActionSelector","ProposalActionSelectorModal","ProposalEditor","ProposalSubmissionModal","CreateProposalButton","proposalThreshold","hasActiveOrPendingProposal","hasEnoughVote","isFormInvalid","handleCreateProposal","formattedProposalThreshold","divide","quotient","exponentiate","BigInt","currency","decimals","toLocaleString","undefined","marginTop","CreateProposalWrapper","styled","AutonomousProposalCTA","div","CreateProposal","account","chainId","latestProposalId","latestProposalData","availableVotes","votes","modalOpen","setModalOpen","hash","setHash","attempting","setAttempting","TRANSFER_TOKEN","proposalAction","setProposalAction","toAddressValue","setToAddressValue","currencyValue","setCurrencyValue","amountValue","setAmountValue","titleValue","setTitleValue","bodyValue","setBodyValue","handleActionSelectorClick","handleActionChange","handleDismissActionSelector","handleDismissSubmissionModal","handleToAddressInput","toAddress","handleCurrencySelect","handleAmountInput","amount","handleTitleInput","title","handleBodyInput","body","Boolean","isToken","greaterThanOrEqual","createProposalCallback","createProposalData","tokenAmount","targets","address","values","description","APPROVE_TOKEN","types","toString","signatures","join","calldatas","i","length","encode","catch","maxWidth","status","ACTIVE","PENDING"],"mappings":"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","sourcesContent":["import { defaultAbiCoder } from '@ethersproject/abi'\nimport { getAddress, isAddress } from '@ethersproject/address'\nimport { Trans } from '@lingui/macro'\nimport { Currency, CurrencyAmount, Token } from '@uniswap/sdk-core'\nimport { ButtonError } from 'components/Button'\nimport { BlueCard } from 'components/Card'\nimport { AutoColumn } from 'components/Column'\nimport { useActiveWeb3React } from 'hooks/web3'\nimport JSBI from 'jsbi'\nimport { Wrapper } from 'pages/Pool/styleds'\nimport React, { useCallback, useMemo, useState } from 'react'\nimport {\n  CreateProposalData,\n  ProposalState,\n  useCreateProposalCallback,\n  useLatestProposalId,\n  useProposalData,\n  useProposalThreshold,\n  useUserVotes,\n} from 'state/governance/hooks'\nimport { tryParseAmount } from 'state/swap/hooks'\nimport styled from 'styled-components/macro'\nimport { ExternalLink, ThemedText } from 'theme'\n\nimport { CreateProposalTabs } from '../../components/NavigationTabs'\nimport { UNI } from '../../constants/tokens'\nimport AppBody from '../AppBody'\nimport { ProposalActionDetail } from './ProposalActionDetail'\nimport { ProposalAction, ProposalActionSelector, ProposalActionSelectorModal } from './ProposalActionSelector'\nimport { ProposalEditor } from './ProposalEditor'\nimport { ProposalSubmissionModal } from './ProposalSubmissionModal'\n\nconst CreateProposalButton = ({\n  proposalThreshold,\n  hasActiveOrPendingProposal,\n  hasEnoughVote,\n  isFormInvalid,\n  handleCreateProposal,\n}: {\n  proposalThreshold?: CurrencyAmount<Token>\n  hasActiveOrPendingProposal: boolean\n  hasEnoughVote: boolean\n  isFormInvalid: boolean\n  handleCreateProposal: () => void\n}) => {\n  const formattedProposalThreshold = proposalThreshold\n    ? JSBI.divide(\n        proposalThreshold.quotient,\n        JSBI.exponentiate(JSBI.BigInt(10), JSBI.BigInt(proposalThreshold.currency.decimals))\n      ).toLocaleString()\n    : undefined\n\n  return (\n    <ButtonError\n      style={{ marginTop: '18px' }}\n      error={hasActiveOrPendingProposal || !hasEnoughVote}\n      disabled={isFormInvalid || hasActiveOrPendingProposal || !hasEnoughVote}\n      onClick={handleCreateProposal}\n    >\n      {hasActiveOrPendingProposal ? (\n        <Trans>You already have an active or pending proposal</Trans>\n      ) : !hasEnoughVote ? (\n        <>\n          {formattedProposalThreshold ? (\n            <Trans>You must have {formattedProposalThreshold} votes to submit a proposal</Trans>\n          ) : (\n            <Trans>You don&apos;t have enough votes to submit a proposal</Trans>\n          )}\n        </>\n      ) : (\n        <Trans>Create Proposal</Trans>\n      )}\n    </ButtonError>\n  )\n}\n\nconst CreateProposalWrapper = styled(Wrapper)`\n  display: flex;\n  flex-flow: column wrap;\n`\n\nconst AutonomousProposalCTA = styled.div`\n  text-align: center;\n  margin-top: 10px;\n`\n\nexport default function CreateProposal() {\n  const { account, chainId } = useActiveWeb3React()\n\n  const latestProposalId = useLatestProposalId(account ?? undefined) ?? '0'\n  // the first argument below should be the index of the latest governor\n  const latestProposalData = useProposalData(/* governorIndex */ 2, latestProposalId)\n  const { votes: availableVotes } = useUserVotes()\n  const proposalThreshold: CurrencyAmount<Token> | undefined = useProposalThreshold()\n\n  const [modalOpen, setModalOpen] = useState(false)\n  const [hash, setHash] = useState<string | undefined>()\n  const [attempting, setAttempting] = useState(false)\n  const [proposalAction, setProposalAction] = useState(ProposalAction.TRANSFER_TOKEN)\n  const [toAddressValue, setToAddressValue] = useState('')\n  const [currencyValue, setCurrencyValue] = useState<Currency>(UNI[chainId ?? 1])\n  const [amountValue, setAmountValue] = useState('')\n  const [titleValue, setTitleValue] = useState('')\n  const [bodyValue, setBodyValue] = useState('')\n\n  const handleActionSelectorClick = useCallback(() => {\n    setModalOpen(true)\n  }, [setModalOpen])\n\n  const handleActionChange = useCallback(\n    (proposalAction: ProposalAction) => {\n      setProposalAction(proposalAction)\n    },\n    [setProposalAction]\n  )\n\n  const handleDismissActionSelector = useCallback(() => {\n    setModalOpen(false)\n  }, [setModalOpen])\n\n  const handleDismissSubmissionModal = useCallback(() => {\n    setHash(undefined)\n    setAttempting(false)\n  }, [setHash, setAttempting])\n\n  const handleToAddressInput = useCallback(\n    (toAddress: string) => {\n      setToAddressValue(toAddress)\n    },\n    [setToAddressValue]\n  )\n\n  const handleCurrencySelect = useCallback(\n    (currency: Currency) => {\n      setCurrencyValue(currency)\n    },\n    [setCurrencyValue]\n  )\n\n  const handleAmountInput = useCallback(\n    (amount: string) => {\n      setAmountValue(amount)\n    },\n    [setAmountValue]\n  )\n\n  const handleTitleInput = useCallback(\n    (title: string) => {\n      setTitleValue(title)\n    },\n    [setTitleValue]\n  )\n\n  const handleBodyInput = useCallback(\n    (body: string) => {\n      setBodyValue(body)\n    },\n    [setBodyValue]\n  )\n\n  const isFormInvalid = useMemo(\n    () =>\n      Boolean(\n        !proposalAction ||\n          !isAddress(toAddressValue) ||\n          !currencyValue?.isToken ||\n          amountValue === '' ||\n          titleValue === '' ||\n          bodyValue === ''\n      ),\n    [proposalAction, toAddressValue, currencyValue, amountValue, titleValue, bodyValue]\n  )\n\n  const hasEnoughVote = Boolean(\n    availableVotes && proposalThreshold && JSBI.greaterThanOrEqual(availableVotes.quotient, proposalThreshold.quotient)\n  )\n\n  const createProposalCallback = useCreateProposalCallback()\n\n  const handleCreateProposal = async () => {\n    setAttempting(true)\n\n    const createProposalData: CreateProposalData = {} as CreateProposalData\n\n    if (!createProposalCallback || !proposalAction || !currencyValue.isToken) return\n\n    const tokenAmount = tryParseAmount(amountValue, currencyValue)\n    if (!tokenAmount) return\n\n    createProposalData.targets = [currencyValue.address]\n    createProposalData.values = ['0']\n    createProposalData.description = `# ${titleValue}\n\n${bodyValue}\n`\n\n    let types: string[][]\n    let values: string[][]\n    switch (proposalAction) {\n      case ProposalAction.TRANSFER_TOKEN: {\n        types = [['address', 'uint256']]\n        values = [[getAddress(toAddressValue), tokenAmount.quotient.toString()]]\n        createProposalData.signatures = [`transfer(${types[0].join(',')})`]\n        break\n      }\n\n      case ProposalAction.APPROVE_TOKEN: {\n        types = [['address', 'uint256']]\n        values = [[getAddress(toAddressValue), tokenAmount.quotient.toString()]]\n        createProposalData.signatures = [`approve(${types[0].join(',')})`]\n        break\n      }\n    }\n\n    createProposalData.calldatas = []\n    for (let i = 0; i < createProposalData.signatures.length; i++) {\n      createProposalData.calldatas[i] = defaultAbiCoder.encode(types[i], values[i])\n    }\n\n    const hash = await createProposalCallback(createProposalData ?? undefined)?.catch(() => {\n      setAttempting(false)\n    })\n\n    if (hash) setHash(hash)\n  }\n\n  return (\n    <AppBody {...{ maxWidth: '800px' }}>\n      <CreateProposalTabs />\n      <CreateProposalWrapper>\n        <BlueCard>\n          <AutoColumn gap=\"10px\">\n            <ThemedText.Link fontWeight={400} color={'primaryText1'}>\n              <Trans>\n                <strong>Tip:</strong> Select an action and describe your proposal for the community. The proposal cannot\n                be modified after submission, so please verify all information before submitting. The voting period will\n                begin immediately and last for 7 days. To propose a custom action,{' '}\n                <ExternalLink href=\"https://uniswap.org/docs/v2/governance/governance-reference/#propose\">\n                  read the docs\n                </ExternalLink>\n                .\n              </Trans>\n            </ThemedText.Link>\n          </AutoColumn>\n        </BlueCard>\n\n        <ProposalActionSelector onClick={handleActionSelectorClick} proposalAction={proposalAction} />\n        <ProposalActionDetail\n          proposalAction={proposalAction}\n          currency={currencyValue}\n          amount={amountValue}\n          toAddress={toAddressValue}\n          onCurrencySelect={handleCurrencySelect}\n          onAmountInput={handleAmountInput}\n          onToAddressInput={handleToAddressInput}\n        />\n        <ProposalEditor\n          title={titleValue}\n          body={bodyValue}\n          onTitleInput={handleTitleInput}\n          onBodyInput={handleBodyInput}\n        />\n        <CreateProposalButton\n          proposalThreshold={proposalThreshold}\n          hasActiveOrPendingProposal={\n            latestProposalData?.status === ProposalState.ACTIVE || latestProposalData?.status === ProposalState.PENDING\n          }\n          hasEnoughVote={hasEnoughVote}\n          isFormInvalid={isFormInvalid}\n          handleCreateProposal={handleCreateProposal}\n        />\n        {!hasEnoughVote ? (\n          <AutonomousProposalCTA>\n            Donâ€™t have 2.5M votes? Anyone can create an autonomous proposal using{' '}\n            <ExternalLink href=\"https://fish.vote\">fish.vote</ExternalLink>\n          </AutonomousProposalCTA>\n        ) : null}\n      </CreateProposalWrapper>\n      <ProposalActionSelectorModal\n        isOpen={modalOpen}\n        onDismiss={handleDismissActionSelector}\n        onProposalActionSelect={(proposalAction: ProposalAction) => handleActionChange(proposalAction)}\n      />\n      <ProposalSubmissionModal isOpen={attempting} hash={hash} onDismiss={handleDismissSubmissionModal} />\n    </AppBody>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}